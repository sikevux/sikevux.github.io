---
layout: post
title: "LVM"
description: "Give it up already"
category: Code
---
{% include JB/setup %}

I was going to install FreeBSD on the laptop, so needed some extra space. I had two VGs in LVM, one vg_nocturnal and the other vg_nocturnal_cur. Rite, so I killed vg_nocturnal with parted (That's stupid..), and then rebooted the system into the FreeBSD installer. Set up the zpool and all that for FreeBSD and then I tried to boot into CentOS again.

Kernel panic.

What the crack?

Tried to boot older kernels, but still panic. Added rdshell, and boom I got errors about luks drives. So I started to google around to find an solution to my nasty problem. To my suprise, everyone told me to reinstall the system.

What is this? Windooze?

So I booted up an CentOS liveCD, went in and luksOpened all my partitions, mounted them, and finally chrooted the whole thing. Well shit is alive at least.

Edited /etc/fstab to not mount anything from the destroyed VG, and same thing with crypttab, and the /etc/lvm/. But with my luck, nothing of this worked.

But then I realized that the kernel is booted with serveral (_several_) options about luks. So after reading the kernel line in the grub config several times I realized that two of the partitions on the killed VG was mentioned.

Kill them with fire!

Then the system booted fine. Almost. The /home luks drive wasn't found, bugger, but at least I got an rescue shell. Damn I love them shells. Mounted /boot, and luksOpened /home. Did an fsck on it, and then mounted it. Tried to change runlevel to 5, but the filesystem was mounted read only.

Gimme a break!

Read only filesystems are a bitch. Unless you rooted an android device (or know it from somewhere else) and remember that mount -n -o remount / pretty much makes / RW again. init 5 and bang, I'm online again.


Lessons learned:
* LVM is evil
* Don't kill VGs using anything else than the lvm utils.
* Don't reinstall the system because it's a difficult problem with it.
* Don't do windooze.
* ZFS is nice on FreeBSD.